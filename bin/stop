#!/usr/bin/env sh

echo "ğŸ›‘ Stopping development servers..."

# PIDãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Railsã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢
if [ -f tmp/pids/server.pid ]; then
  echo "ğŸ“± Stopping Rails server..."
  kill $(cat tmp/pids/server.pid) 2>/dev/null || true
  rm -f tmp/pids/server.pid
  echo "âœ… Rails server stopped"
else
  echo "â„¹ï¸  No Rails server PID file found"
fi

# ãƒãƒ¼ãƒˆ3000ã¨3036ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
echo "ğŸ”Œ Stopping processes on ports 3000 and 3036..."

# ãƒãƒ¼ãƒˆ3000ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
PIDS_3000=$(lsof -ti:3000 2>/dev/null)
if [ ! -z "$PIDS_3000" ]; then
  echo "ğŸ“± Stopping processes on port 3000: $PIDS_3000"
  echo $PIDS_3000 | xargs kill 2>/dev/null || true
else
  echo "â„¹ï¸  No processes on port 3000"
fi

# ãƒãƒ¼ãƒˆ3036ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
PIDS_3036=$(lsof -ti:3036 2>/dev/null)
if [ ! -z "$PIDS_3036" ]; then
  echo "âš¡ Stopping processes on port 3036: $PIDS_3036"
  echo $PIDS_3036 | xargs kill 2>/dev/null || true
else
  echo "â„¹ï¸  No processes on port 3036"
fi

echo "âœ… All development servers stopped"
echo ""
echo "ğŸ’¡ To start again, run: bin/dev"
echo "ğŸ’¡ To stop in the future, use: Ctrl+C or bin/stop"